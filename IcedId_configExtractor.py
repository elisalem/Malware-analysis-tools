
import binascii
import arc4
import pefile

# This script receive file path and extract the config of the second stage of icedid banking trojan  

def dec_rc4(key, data):            # decrypt rc4 algorithm
    cipher = arc4.ARC4(key)
    decrypted = cipher.decrypt(data)
    print(decrypted)


def extractDataSeciton(file):      # extract the data section
    pe = pefile.PE(file)
    for section in pe.sections:
        if ".data" in section.Name:
            return section.get_data()

def main():



    path = raw_input('enter the path of the file: ')
    rawdata = extractDataSeciton(path)

    key = rawdata[:8]            # first 8 bytes of the blob is the key
    data = rawdata[8:]           # rest of the bytes are the config

    print(dec_rc4(key, data))


if __name__ == '__main__':
    main()
